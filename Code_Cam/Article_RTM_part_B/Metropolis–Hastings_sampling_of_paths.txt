"Transportation Research Part B: MethodologicalMetropolis\u2013Hastings sampling of pathsAbstract We consider the previously unsolved problem of sampling paths according to a given distribution from a general network. The problem is difficult because of the combinatorial number of alternatives, which prohibits a complete enumeration of all paths and hence also forbids to compute the normalizing constant of the sampling distribution. The problem is important because the ability to sample from a known distribution introduces mathematical rigor into many applications, including the estimation of choice models with sampling of alternatives that can be formalized as paths in a decision network (most obviously route choice), probabilistic map matching, dynamic traffic assignment, and route guidance.serial JL 271728 291210 291772 291817 31 Transportation Research Part B: Methodological TRANSPORTATIONRESEARCHPARTBMETHODOLOGICAL 2012-12-29 2012-12-29 2013-02-11T16:10:56 1-s2.0-S019126151200152X S0191-2615(12)00152-X S019126151200152X 10.1016/j.trb.2012.11.002 S300 S300.2 FULL-TEXT 1-s2.0-S0191261512X00110 2015-05-14T05:39:52.915433-04:00 0 0 20130201 20130228 2013 2012-12-29T00:00:00Z articleinfo crossmark dco dateupdated tomb dateloaded datesearch indexeddate volumelist yearnav articletitlenorm authfirstinitialnorm authfirstsurnamenorm cid cids contenttype copyright dateloadedtxt docsubtype doctype doi eid ewtransactionid hubeid issn issnnorm itemstage itemtransactionid itemweight openaccess openarchive pg pgfirst pglast pii piinorm pubdateend pubdatestart pubdatetxt pubyr sortorder srctitle srctitlenorm srctype subheadings suppl volfirst volissue webpdf webpdfpagecount figure table body mmlmath acknowledge affil articletitle auth authfirstini authfull authkeywords authlast footnotes primabst ref specialabst alllist content subj ssids 0191-2615 01912615 true 48 48 C Volume 48 5 53 66 53 66 201302 February 2013 2013-02-01 2013-02-28 2013 article fla Copyright \u00a9 2012 Elsevier Ltd. All rights reserved. METROPOLISHASTINGSSAMPLINGPATHS FLOTTEROD G 1 Introduction 2 Framework 2.1 Generic Metropolis\u2013Hastings algorithm 2.2 State space definition 2.3 Target weights 2.4 Generic definition of proposal distribution 2.4.1 SPLICE operation 2.4.2 SHUFFLE operation 2.4.3 Combined proposal 2.4.4 Irreducibility 2.5 Concrete instance of proposal distribution 2.6 Implementation notes 2.6.1 Logarithmic probabilities 2.6.2 Unique SP ordering 2.6.3 Scale-invariance 3 Experiments 3.1 Simple example 3.2 Complex example 4 Conclusion Acknowledgment References BEKHOR 2006 235 247 S BIERLAIRE 2013 78 98 M BOTTOM 1999 577 600 J PROCEEDINGS14THINTERNATIONALSYMPOSIUMTRANSPORTATIONTRAFFICTHEORY INVESTIGATIONROUTEGUIDANCEGENERATIONISSUESBYSIMULATIONDYNAMIT BOWMAN 1998 27 46 J EQUILIBRIUMADVANCEDTRANSPORTATIONMODELLING ACTIVITYBASEDTRAVELDEMANDMODELSYSTEMS DIJKSTRA 1959 269 271 E FLOTTEROD 2011 541 561 G FREJINGER 2010 307 315 E CHOICEMODELLINGSTATEOFTHEARTSTATEOFPRACTICE PATHGENERATIONALGORITHMSFORROUTECHOICEMODELS FREJINGER 2009 984 994 E HASTINGS 1970 97 W FLOTTERODX2013X53 FLOTTERODX2013X53X66 FLOTTERODX2013X53XG FLOTTERODX2013X53X66XG item S0191-2615(12)00152-X S019126151200152X 1-s2.0-S019126151200152X 10.1016/j.trb.2012.11.002 271728 2013-02-11T12:23:31.021542-05:00 2013-02-01 2013-02-28 1-s2.0-S019126151200152X-main.pdf https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/MAIN/application/pdf/7382962980b3516de03633be80e38fc9/main.pdf https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/MAIN/application/pdf/7382962980b3516de03633be80e38fc9/main.pdf main.pdf pdf true 1529605 MAIN 14 1-s2.0-S019126151200152X-main_1.png https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/PREVIEW/image/png/aeeea14294a9850cad09b2e458c848c5/main_1.png https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/PREVIEW/image/png/aeeea14294a9850cad09b2e458c848c5/main_1.png main_1.png png 49063 849 656 IMAGE-WEB-PDF 1 1-s2.0-S019126151200152X-si43.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/133a9bfd73aa217d83e5d0b0229f9516/si43.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/133a9bfd73aa217d83e5d0b0229f9516/si43.gif si43 si43.gif gif 922 46 146 ALTIMG 1-s2.0-S019126151200152X-si42.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/f2ee213a6bbe2e31a0597617aea8fcfa/si42.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/f2ee213a6bbe2e31a0597617aea8fcfa/si42.gif si42 si42.gif gif 1463 48 211 ALTIMG 1-s2.0-S019126151200152X-si40.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/817dfe2a4b395e75e03044a8ed3e614e/si40.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/817dfe2a4b395e75e03044a8ed3e614e/si40.gif si40 si40.gif gif 712 42 108 ALTIMG 1-s2.0-S019126151200152X-si39.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/b1c88c8c7259a11fa351f455a3f763a0/si39.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/b1c88c8c7259a11fa351f455a3f763a0/si39.gif si39 si39.gif gif 1510 18 369 ALTIMG 1-s2.0-S019126151200152X-si37.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/43281be6aa2185c1451d7663d7997b92/si37.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/43281be6aa2185c1451d7663d7997b92/si37.gif si37 si37.gif gif 2516 43 408 ALTIMG 1-s2.0-S019126151200152X-si36.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/011acc74448142bdcad25e71bc64f0c5/si36.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/011acc74448142bdcad25e71bc64f0c5/si36.gif si36 si36.gif gif 2516 62 467 ALTIMG 1-s2.0-S019126151200152X-si33.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/5768022c7c31cc55c1b8018a318472dd/si33.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/5768022c7c31cc55c1b8018a318472dd/si33.gif si33 si33.gif gif 3634 60 434 ALTIMG 1-s2.0-S019126151200152X-si16.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/09ef21d4cd3bc5c55b4c146b75761a38/si16.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/09ef21d4cd3bc5c55b4c146b75761a38/si16.gif si16 si16.gif gif 1443 42 222 ALTIMG 1-s2.0-S019126151200152X-si15.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/e9c4e191719153e50bfe0d796857f277/si15.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/e9c4e191719153e50bfe0d796857f277/si15.gif si15 si15.gif gif 1188 42 222 ALTIMG 1-s2.0-S019126151200152X-si9.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/320332173dea1ca3bd2e7f0c90115a1a/si9.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/320332173dea1ca3bd2e7f0c90115a1a/si9.gif si9 si9.gif gif 527 18 80 ALTIMG 1-s2.0-S019126151200152X-si8.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/3739d4d650b4abf32c7ff29b41b9607f/si10.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/3739d4d650b4abf32c7ff29b41b9607f/si10.gif si8 si8.gif gif 371 16 56 ALTIMG 1-s2.0-S019126151200152X-si7.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/86a033d01039278ddb5b8ce116fb35f7/si7.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/86a033d01039278ddb5b8ce116fb35f7/si7.gif si7 si7.gif gif 511 17 73 ALTIMG 1-s2.0-S019126151200152X-si6.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/db4d067453c1327f3451347b4f39acec/si6.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/db4d067453c1327f3451347b4f39acec/si6.gif si6 si6.gif gif 223 14 19 ALTIMG 1-s2.0-S019126151200152X-si5.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/d208d78fb25732141eb0ce91c37f99f4/si5.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/d208d78fb25732141eb0ce91c37f99f4/si5.gif si5 si5.gif gif 1153 30 183 ALTIMG 1-s2.0-S019126151200152X-si49.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/865267a940ad27c01696eb239ed8f75e/si47.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/865267a940ad27c01696eb239ed8f75e/si47.gif si49 si49.gif gif 318 18 32 ALTIMG 1-s2.0-S019126151200152X-si48.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/9ac98675d858f619dc54f949a507ae1b/si48.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/9ac98675d858f619dc54f949a507ae1b/si48.gif si48 si48.gif gif 629 18 114 ALTIMG 1-s2.0-S019126151200152X-si47.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/865267a940ad27c01696eb239ed8f75e/si47.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/865267a940ad27c01696eb239ed8f75e/si47.gif si47 si47.gif gif 318 18 32 ALTIMG 1-s2.0-S019126151200152X-si46.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/cc0628fff513a66ddbaf019097e3cd0c/si45.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/cc0628fff513a66ddbaf019097e3cd0c/si45.gif si46 si46.gif gif 222 17 13 ALTIMG 1-s2.0-S019126151200152X-si45.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/cc0628fff513a66ddbaf019097e3cd0c/si45.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/cc0628fff513a66ddbaf019097e3cd0c/si45.gif si45 si45.gif gif 222 17 13 ALTIMG 1-s2.0-S019126151200152X-si44.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/89319b2240aa2fd884e1afbfe142ce39/si44.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/89319b2240aa2fd884e1afbfe142ce39/si44.gif si44 si44.gif gif 737 18 145 ALTIMG 1-s2.0-S019126151200152X-si41.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/7abdac17924460d288b903377fd8c681/si41.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/7abdac17924460d288b903377fd8c681/si41.gif si41 si41.gif gif 306 18 45 ALTIMG 1-s2.0-S019126151200152X-si4.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/0b298f61f42afb81bf37601988e8bfe7/si4.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/0b298f61f42afb81bf37601988e8bfe7/si4.gif si4 si4.gif gif 284 13 37 ALTIMG 1-s2.0-S019126151200152X-si38.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/8de27f775e38faf423a347ad18b6fe48/si38.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/8de27f775e38faf423a347ad18b6fe48/si38.gif si38 si38.gif gif 1178 30 189 ALTIMG 1-s2.0-S019126151200152X-si35.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/cddc297efbd8dbce67d37d81edfe3e49/si35.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/cddc297efbd8dbce67d37d81edfe3e49/si35.gif si35 si35.gif gif 305 18 45 ALTIMG 1-s2.0-S019126151200152X-si34.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/cc0628fff513a66ddbaf019097e3cd0c/si45.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/cc0628fff513a66ddbaf019097e3cd0c/si45.gif si34 si34.gif gif 222 17 13 ALTIMG 1-s2.0-S019126151200152X-si32.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/0a87ae604538c509753315e8185bfbd2/si17.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/0a87ae604538c509753315e8185bfbd2/si17.gif si32 si32.gif gif 323 14 46 ALTIMG 1-s2.0-S019126151200152X-si31.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/0c150b35085f8b5ded431ab0ac678ebf/si31.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/0c150b35085f8b5ded431ab0ac678ebf/si31.gif si31 si31.gif gif 366 17 55 ALTIMG 1-s2.0-S019126151200152X-si30.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/f107a04920c615b47ffd6aa0491de1c9/si28.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/f107a04920c615b47ffd6aa0491de1c9/si28.gif si30 si30.gif gif 354 17 54 ALTIMG 1-s2.0-S019126151200152X-si3.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/9f8bce91ff3776a85a7cb935b9e8cf81/si3.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/9f8bce91ff3776a85a7cb935b9e8cf81/si3.gif si3 si3.gif gif 209 13 13 ALTIMG 1-s2.0-S019126151200152X-si29.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/0c150b35085f8b5ded431ab0ac678ebf/si31.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/0c150b35085f8b5ded431ab0ac678ebf/si31.gif si29 si29.gif gif 366 17 55 ALTIMG 1-s2.0-S019126151200152X-si28.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/f107a04920c615b47ffd6aa0491de1c9/si28.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/f107a04920c615b47ffd6aa0491de1c9/si28.gif si28 si28.gif gif 354 17 54 ALTIMG 1-s2.0-S019126151200152X-si27.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/4290deda5992ef77c6f6f8c1d2526540/si27.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/4290deda5992ef77c6f6f8c1d2526540/si27.gif si27 si27.gif gif 351 17 41 ALTIMG 1-s2.0-S019126151200152X-si26.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/009cb3a6dd7b1a848505765a62597186/si26.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/009cb3a6dd7b1a848505765a62597186/si26.gif si26 si26.gif gif 343 17 41 ALTIMG 1-s2.0-S019126151200152X-si25.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/1ff3956580a550789a045acadaf245aa/si25.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/1ff3956580a550789a045acadaf245aa/si25.gif si25 si25.gif gif 786 20 215 ALTIMG 1-s2.0-S019126151200152X-si24.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/3d0d570366c7cdf306bb8d31541a11d5/si24.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/3d0d570366c7cdf306bb8d31541a11d5/si24.gif si24 si24.gif gif 425 21 106 ALTIMG 1-s2.0-S019126151200152X-si23.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/326f780eabc6c3d77badb4df8a313cab/si23.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/326f780eabc6c3d77badb4df8a313cab/si23.gif si23 si23.gif gif 202 15 14 ALTIMG 1-s2.0-S019126151200152X-si22.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/b1312b4a34c46fdece3af26b47d8690a/si22.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/b1312b4a34c46fdece3af26b47d8690a/si22.gif si22 si22.gif gif 887 21 234 ALTIMG 1-s2.0-S019126151200152X-si21.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/0d40bbec2ea826b65364dc1f6cc05bdb/si21.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/0d40bbec2ea826b65364dc1f6cc05bdb/si21.gif si21 si21.gif gif 1001 17 241 ALTIMG 1-s2.0-S019126151200152X-si20.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/c42b69697ea9e97eec684bbb05250d04/si20.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/c42b69697ea9e97eec684bbb05250d04/si20.gif si20 si20.gif gif 761 19 148 ALTIMG 1-s2.0-S019126151200152X-si2.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/9c457eb5be77fefeabbad6e46cad25e4/si2.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/9c457eb5be77fefeabbad6e46cad25e4/si2.gif si2 si2.gif gif 451 19 60 ALTIMG 1-s2.0-S019126151200152X-si19.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/d1a047b122a1bdd9fdcf2b490116eb84/si19.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/d1a047b122a1bdd9fdcf2b490116eb84/si19.gif si19 si19.gif gif 972 17 241 ALTIMG 1-s2.0-S019126151200152X-si18.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/d75a155e33a203e85b91be23e6255081/si18.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/d75a155e33a203e85b91be23e6255081/si18.gif si18 si18.gif gif 770 19 149 ALTIMG 1-s2.0-S019126151200152X-si17.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/0a87ae604538c509753315e8185bfbd2/si17.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/0a87ae604538c509753315e8185bfbd2/si17.gif si17 si17.gif gif 323 14 46 ALTIMG 1-s2.0-S019126151200152X-si14.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/8f215ed55bd92a14f2c6e237d272ca87/si13.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/8f215ed55bd92a14f2c6e237d272ca87/si13.gif si14 si14.gif gif 608 19 132 ALTIMG 1-s2.0-S019126151200152X-si13.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/8f215ed55bd92a14f2c6e237d272ca87/si13.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/8f215ed55bd92a14f2c6e237d272ca87/si13.gif si13 si13.gif gif 608 19 132 ALTIMG 1-s2.0-S019126151200152X-si12.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/073a84653e42780305824d4e72ae5e9c/si12.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/073a84653e42780305824d4e72ae5e9c/si12.gif si12 si12.gif gif 1134 40 226 ALTIMG 1-s2.0-S019126151200152X-si11.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/9f8bce91ff3776a85a7cb935b9e8cf81/si3.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/9f8bce91ff3776a85a7cb935b9e8cf81/si3.gif si11 si11.gif gif 209 13 13 ALTIMG 1-s2.0-S019126151200152X-si10.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/3739d4d650b4abf32c7ff29b41b9607f/si10.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/3739d4d650b4abf32c7ff29b41b9607f/si10.gif si10 si10.gif gif 371 16 56 ALTIMG 1-s2.0-S019126151200152X-si1.gif https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/STRIPIN/image/gif/865267a940ad27c01696eb239ed8f75e/si47.gif https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/STRIPIN/image/gif/865267a940ad27c01696eb239ed8f75e/si47.gif si1 si1.gif gif 318 18 32 ALTIMG 1-s2.0-S019126151200152X-gr1.jpg https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr1/DOWNSAMPLED/image/jpeg/7366d8225e01112312f8124db9df5a69/gr1.jpg https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr1/DOWNSAMPLED/image/jpeg/7366d8225e01112312f8124db9df5a69/gr1.jpg gr1 gr1.jpg jpg 7600 111 333 IMAGE-DOWNSAMPLED 1-s2.0-S019126151200152X-gr9.jpg https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr9/DOWNSAMPLED/image/jpeg/6050f05571429b26f18410f5441d2b1e/gr9.jpg https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr9/DOWNSAMPLED/image/jpeg/6050f05571429b26f18410f5441d2b1e/gr9.jpg gr9 gr9.jpg jpg 49499 602 333 IMAGE-DOWNSAMPLED 1-s2.0-S019126151200152X-gr8.jpg https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr8/DOWNSAMPLED/image/jpeg/fcc5ac004a2eea2eae7e6f322fc24701/gr8.jpg https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr8/DOWNSAMPLED/image/jpeg/fcc5ac004a2eea2eae7e6f322fc24701/gr8.jpg gr8 gr8.jpg jpg 16372 186 511 IMAGE-DOWNSAMPLED 1-s2.0-S019126151200152X-gr7.jpg https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr7/DOWNSAMPLED/image/jpeg/d864cb166340dc090f8af555724ae9e6/gr7.jpg https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr7/DOWNSAMPLED/image/jpeg/d864cb166340dc090f8af555724ae9e6/gr7.jpg gr7 gr7.jpg jpg 21274 195 497 IMAGE-DOWNSAMPLED 1-s2.0-S019126151200152X-gr6.jpg https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr6/DOWNSAMPLED/image/jpeg/6aa22828f266e39cbff14533da8476de/gr6.jpg https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr6/DOWNSAMPLED/image/jpeg/6aa22828f266e39cbff14533da8476de/gr6.jpg gr6 gr6.jpg jpg 19774 318 444 IMAGE-DOWNSAMPLED 1-s2.0-S019126151200152X-gr5.jpg https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr5/DOWNSAMPLED/image/jpeg/b68eb976b53f4f825f16f59a64fb76fc/gr5.jpg https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr5/DOWNSAMPLED/image/jpeg/b68eb976b53f4f825f16f59a64fb76fc/gr5.jpg gr5 gr5.jpg jpg 52627 433 710 IMAGE-DOWNSAMPLED 1-s2.0-S019126151200152X-gr4.jpg https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr4/DOWNSAMPLED/image/jpeg/f690eba667fad12c78f3f19dd40b6729/gr4.jpg https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr4/DOWNSAMPLED/image/jpeg/f690eba667fad12c78f3f19dd40b6729/gr4.jpg gr4 gr4.jpg jpg 22898 260 413 IMAGE-DOWNSAMPLED 1-s2.0-S019126151200152X-gr3.jpg https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr3/DOWNSAMPLED/image/jpeg/dcd70c261f215fed79c6aec2d78cad63/gr3.jpg https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr3/DOWNSAMPLED/image/jpeg/dcd70c261f215fed79c6aec2d78cad63/gr3.jpg gr3 gr3.jpg jpg 31329 354 410 IMAGE-DOWNSAMPLED 1-s2.0-S019126151200152X-gr2.jpg https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr2/DOWNSAMPLED/image/jpeg/d06ae1ad4b23772cb4288988c87a8a45/gr2.jpg https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr2/DOWNSAMPLED/image/jpeg/d06ae1ad4b23772cb4288988c87a8a45/gr2.jpg gr2 gr2.jpg jpg 11616 193 384 IMAGE-DOWNSAMPLED 1-s2.0-S019126151200152X-gr10.jpg https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr10/DOWNSAMPLED/image/jpeg/8cbcc49a6d1246ff7c6e9ab129e3902b/gr10.jpg https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr10/DOWNSAMPLED/image/jpeg/8cbcc49a6d1246ff7c6e9ab129e3902b/gr10.jpg gr10 gr10.jpg jpg 112582 629 402 IMAGE-DOWNSAMPLED 1-s2.0-S019126151200152X-gr1.sml https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr1/THUMBNAIL/image/gif/60ef778e36cabbb1e90c6e7856133f0f/gr1.sml https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr1/THUMBNAIL/image/gif/60ef778e36cabbb1e90c6e7856133f0f/gr1.sml gr1 gr1.sml sml 2526 73 219 IMAGE-THUMBNAIL 1-s2.0-S019126151200152X-gr9.sml https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr9/THUMBNAIL/image/gif/7cb5c37d8781df86aa70f4a5dc1faaa5/gr9.sml https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr9/THUMBNAIL/image/gif/7cb5c37d8781df86aa70f4a5dc1faaa5/gr9.sml gr9 gr9.sml sml 2767 163 90 IMAGE-THUMBNAIL 1-s2.0-S019126151200152X-gr8.sml https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr8/THUMBNAIL/image/gif/5a0e5a61ef163dded372c39efc6f1597/gr8.sml https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr8/THUMBNAIL/image/gif/5a0e5a61ef163dded372c39efc6f1597/gr8.sml gr8 gr8.sml sml 3054 80 219 IMAGE-THUMBNAIL 1-s2.0-S019126151200152X-gr7.sml https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr7/THUMBNAIL/image/gif/a7d388c9238b0c4e8bcebb3b8faf4893/gr7.sml https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr7/THUMBNAIL/image/gif/a7d388c9238b0c4e8bcebb3b8faf4893/gr7.sml gr7 gr7.sml sml 3578 86 219 IMAGE-THUMBNAIL 1-s2.0-S019126151200152X-gr6.sml https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr6/THUMBNAIL/image/gif/d48217df3b8cc94edab514359cbfb0df/gr6.sml https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr6/THUMBNAIL/image/gif/d48217df3b8cc94edab514359cbfb0df/gr6.sml gr6 gr6.sml sml 2710 157 219 IMAGE-THUMBNAIL 1-s2.0-S019126151200152X-gr5.sml https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr5/THUMBNAIL/image/gif/5407b2ae6bcdf581ecbb76e03366782b/gr5.sml https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr5/THUMBNAIL/image/gif/5407b2ae6bcdf581ecbb76e03366782b/gr5.sml gr5 gr5.sml sml 4697 134 219 IMAGE-THUMBNAIL 1-s2.0-S019126151200152X-gr4.sml https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr4/THUMBNAIL/image/gif/6796769742883ad9a3c5d29bd1cffac7/gr4.sml https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr4/THUMBNAIL/image/gif/6796769742883ad9a3c5d29bd1cffac7/gr4.sml gr4 gr4.sml sml 5076 138 219 IMAGE-THUMBNAIL 1-s2.0-S019126151200152X-gr3.sml https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr3/THUMBNAIL/image/gif/32f7d2278fc388cba299bb4b1ab998f4/gr3.sml https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr3/THUMBNAIL/image/gif/32f7d2278fc388cba299bb4b1ab998f4/gr3.sml gr3 gr3.sml sml 5226 164 190 IMAGE-THUMBNAIL 1-s2.0-S019126151200152X-gr2.sml https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr2/THUMBNAIL/image/gif/49c2e7def934512f9e5b8fe14b47d8f7/gr2.sml https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr2/THUMBNAIL/image/gif/49c2e7def934512f9e5b8fe14b47d8f7/gr2.sml gr2 gr2.sml sml 2913 110 219 IMAGE-THUMBNAIL 1-s2.0-S019126151200152X-gr10.sml https://s3.amazonaws.com/prod-ucs-content-store-us-east/content/pii:S019126151200152X/gr10/THUMBNAIL/image/gif/ea0de52861674a00e832136ffd88a15c/gr10.sml https://s3-eu-west-1.amazonaws.com/prod-ucs-content-store-eu-west/content/pii:S019126151200152X/gr10/THUMBNAIL/image/gif/ea0de52861674a00e832136ffd88a15c/gr10.sml gr10 gr10.sml sml 7440 163 104 IMAGE-THUMBNAIL TRB 1048 S0191-2615(12)00152-X 10.1016/j.trb.2012.11.002 Elsevier Ltd Fig. 1 \u201cRubber band\u201d-like variation of a path. Fig. 2 SPLICE example. Fig. 3 Typology of outer cycles. Fig. 4 Typology of inner cycles. Fig. 5 Computation of proposal probability q(i, i\u2032) from i =(\u0393, a, b, c) to i\u2032=(\u0393\u2032, a\u2032, b\u2032, c\u2032). Fig. 6 Simple test network. Fig. 7 Distance-dependent path similarity in simple example. Fig. 8 Scatter plots in simple example. Fig. 9 Tel-Aviv network. Fig. 10 Link coverage in Tel-Aviv network for different \u03bc values. Table 1 Computational results for Tel-Aviv test case. \u03bc P splice \u03bc \u02dc / \u03bc Total runtime (h) Iterations/sample (1000) Time/independent sample (s) 0.01 0.25 0.5 5.9/6.0/5.8 41/36/40 87.5/77.5/ 83.4 1.0 6.1/5.8/6.1 48/41/46 104.6/86.2/101.6 2.0 5.6/5.7/5.7 51/61/68 103.1/124.8/140.3 0.5 0.5 6.9/8.0/6.6 30/38/28 74.1/109.4/66.6 1.0 6.3/6.2/6.0 23/27/22 52.1/60.0/47.9 2.0 6.3/6.2/6.3 43/45/37 96.9/100.8/83.6 0.75 0.5 7.0/6.8/6.8 28/31/31 70.2/75.4/76.4 1.0 4.6/4.5/4.5 24/23/27 39.5/37.2/43.6 2.0 6.5/6.4/6.3 35/34/44 82.5/78.5/100.2 0.02 0.25 0.5 6.6/6.4/6.4 9/8/11 21.3/18.3/25.5 1.0 6.2/5.8/5.9 14/14/10 31.2/29.2/21.3 2.0 3.8/3.8/3.9 22/24/32 30.0/32.7/44.7 0.5 0.5 7.1/7.0/6.8 7/8/7 17.9/20.1/17.2 1.0 6.3/6.1/6.1 9/8/9 20.5/17.7/19.9 2.0 6.3/6.3/6.2 16/21/22 36.4/47.4/48.7 0.75 0.5 5.6/5.5/5.4 6/8/7 12.2/15.8/13.7 1.0 4.8/4.8/4.8 11/9/11 19.0/15.6/19.1 2.0 6.4/6.1/6.2 15/20/20 34.4/44.1/44.7 0.04 0.25 0.5 6.0/5.9/5.8 3/4/3 6.6/8.6/6.3 1.0 5.6/5.3/5.3 4/4/3 8.1/7.7/5.7 2.0 5.3/5.3/5.4 6/12/7 11.4/23.0/13.6 0.5 0.5 6.5/6.4/6.5 2/2/2 4.7/4.6/4.6 1.0 5.7/5.6/5.7 2/2/2 4.1/4.0/4.1 2.0 5.5/5.3/5.4 6/7/7 12.0/13.4/13.7 0.75 0.5 4.9/4.7/4.7 2/2/3 3.5/3.4/5.1 1.0 6.2/6.2/6.2 2/3/3 4.5/6.7/6.7 2.0 5.7/5.6/5.5 6/9/6 12.4/18.1/11.9 Metropolis\u2013Hastings sampling of paths Gunnar Fl\u00f6tter\u00f6d a \u204e gunnar.floetteroed@abe.kth.se Michel Bierlaire b michel.bierlaire@epfl.ch a KTH Royal Institute of Technology, Department of Transport Science, 11428 Stockholm, Sweden b \u00c9cole Polytechnique F\u00e9d\u00e9rale de Lausanne (EPFL), School of Architecture, Civil and Environmental Engineering (ENAC), Transport and Mobility Laboratory (TRANSP-OR), CH-1015 Lausanne, Switzerland \u204e Corresponding author. Tel.: +46 (0)8 7908377; fax: +46 (0)8 212899. Highlights \u25ba Sampling of paths according to given distributions in general networks. \u25ba Wide range of transportation-related applications. \u25ba Applicability to large real-world problem instances. \u25ba Thorough experimental analysis of algorithmic correctness and efficiency. Abstract We consider the previously unsolved problem of sampling paths according to a given distribution from a general network. The problem is difficult because of the combinatorial number of alternatives, which prohibits a complete enumeration of all paths and hence also forbids to compute the normalizing constant of the sampling distribution. The problem is important because the ability to sample from a known distribution introduces mathematical rigor into many applications, including the estimation of choice models with sampling of alternatives that can be formalized as paths in a decision network (most obviously route choice), probabilistic map matching, dynamic traffic assignment, and route guidance. Keywords Path sampling Metropolis\u2013Hastings Sampling of alternatives in decision networks 1 Introduction This article proposes a novel method to sample paths according to a given distribution from a general network. This is a previously unsolved problem. The method is designed so that the analyst is in full control of the sampling protocol, and it is able to sample paths from real networks (we illustrate it with the Tel-Aviv network composed of about 17000 links and 8000 nodes). The algorithm is not bound to transportation-related applications and can be applied in any circumstance where a sample of paths following a predefined distribution is needed. The method is an instance of the Metropolis\u2013Hastings algorithm (Hastings, 1970). This algorithm generates a Markov chain with a predefined stationary distribution, which can be defined in an unnormalized form. The absence of the normalizing constant is the key feature to avoid the enumeration of paths in our approach. Intuitively, the method functions as follows. It starts with an arbitrary (e.g., shortest) path between a given origin and destination. It then repeatedly carries out random modifications of the path. Based on the known probability of each random modification, this modification is either accepted or rejected. This decision is made such that the long-term frequency of each path\u2019s occurrence in the process coincides with the analyst\u2019s specification. Fig. 1 indicates how the random modification of a path is realized: Essentially, two (random) points within a given path are fixed, a third (random) point in between is selected, and this intermediate point is then dragged to a (random) new position. The path segment between the two fixations follows this modification like a rubber band. The main difference to the actual algorithm is that it operates on a network, meaning that the continuous \u201cdragging\u201d of the intermediate point needs to be matched on that network. The proposed path sampling method is highly relevant is a wide variety of applications. We briefly comment here some of them. In the context of route choice modeling, the potentially huge number of paths between an origin and a destination precludes their enumeration, which would be necessary to build the choice set. A method based on sampling of paths has been proposed by Frejinger et al. (2009). As discussed in details by Frejinger and Bierlaire (2010), importance sampling of paths is a powerful method for route choice models but requires to have access to the sampling probabilities in order to obtain a consistent estimator. This paper proposes the first algorithm that is able to sample paths from an arbitrary distribution for general networks. Other existing Monte Carlo methods for path sampling do not give the analyst control over the sampling distribution; that is, they provide samples but not their probabilities. The arguably most representative example of these methods is the computation of shortest paths based on randomized link costs (e.g., Bekhor et al., 2006). Such methods may be computationally more efficient than the approach presented here, but they are limited to applications where the sampling probabilities need not be known. Other choice models with large choice sets may also exploit the same ideas. For instance, the choice of activity sequence is of similar combinatorial complexity as the route choice problem (Bowman and Ben-Akiva, 1998). Actually, it can be shown that the activity sequencing problem can be phrased as the problem of choosing a path through a decision network, extending the relevance of the proposed sampling algorithm to this context. The ability to sample paths from arbitrary distributions enables a new solution to the map matching problem with coarse GPS data. Bierlaire et al. (2013) propose a method that assigns to each path in the network the probability that a given GPS trace has been generated by a traveler following this path. The method proposed in the present article allows to exploit the likelihood function of Bierlaire et al. (2013) in a sampling context. The proposed method also fits naturally into iterated simulation approaches to the dynamic traffic assignment (DTA) problem. Although it is often not stated explicitly, these simulations typically run a Markov chain of network states until stationarity is reached, where in every iteration a demand simulator and a supply simulator are evaluated (Fl\u00f6tter\u00f6d et al., 2011). The consistent anticipatory route guidance (CARG) problem is to recommend routes to travelers such that the network conditions that were assumed when computing the routes actually occur. The generation of such a guidance requires solving a stochastic fixed point of route recommendations (Bottom, 2000; Bottom et al., 1999). In order to iteratively approach this fixed point in a microsimulation setting, one has to sample from this distribution. The flexibility of the proposed method does not only lend itself to this task; the fact that the stationary path distribution attained by the method constitutes itself a stochastic fixed point again suggests to solve the CARG problem and the path sampling problem jointly in one Markov chain. The remainder of this article is organized as follows. The method is described in Section 2, and illustrated and validated in Section 3. Finally, Section 4 concludes the article. 2 Framework Starting with a brief repetition of the generic Metropolis\u2013Hastings algorithm in Section 2.1, a family of concrete instances of this algorithm for path generation is developed. Sections 2.2 and 2.3 define its state space and target weights. A general class of irreducible proposal distributions is introduced in Section 2.4. A concrete instance of this framework is then specified in Section 2.5. Finally, some implementation notes are given in Section 2.6. 2.1 Generic Metropolis\u2013Hastings algorithm The Metropolis\u2013Hastings (MH) algorithm creates a Markov chain (MC) with a predefined stationary distribution. This distribution can be defined in unnormalized form through positive weights { b ( i ) } i \u2208 S where S is the MC\u2019s finite state space and b(i) is proportional to the stationary probability of state i \u2208 S . The MH algorithm further requires to define an irreducible proposal distribution Q = (q(i, j)) that defines the probability of proposing a transition from state i to state j. (Irreducibility is given if every state j can be reached from every state i through one or more transitions.) In every iteration of the algorithm, a proposal transition i \u2192 j is drawn according to Q, and then this proposal is accepted with a certain probability \u03b1(i, j) that is specified such that the desired stationary distribution is attained. Algorithm 1 specifies the generic MH algorithm. Algorithm 1 Metropolis\u2013Hastings algorithm 1. Set iteration counter k =0. 2. Select arbitrary initial state i k . 3. Repeat beyond stationarity: (a) Draw candidate state j from {q(i k , j)} j . (b) Compute acceptance probability \u03b1 ( i k , j ) = min b ( j ) q ( j , i k ) b ( i k ) q ( i k , j ) , 1 . (c) With probability \u03b1(i k , j), let i k+1 = j; else, let i k+1 = i k . (d) Increase k by one. Apart from the requirement of irreducibility, operational considerations affect the choice of the proposal distribution Q. If Q generates insufficient variability in that it creates long sequences of similar states, the MC needs many iterations to cover the relevant part of the state space (where relevance is defined through the weights b). If Q generates too much variability, the MC frequently proposes jumps out of the relevant part of the state space, which results in low acceptance probabilities and long persistence in the same state. Algorithm 1 requires to compute q(j, i)/q(i, j) for every proposed transition i \u2192 j, which should be possible in a computationally efficient manner due to the large number of such computations conducted. The probabilities of \u201cself-loops\u201d, i.e., transitions of states to themselves, cancel out and hence need not be computed. This feature will subsequently be exploited in that it allows to forbid certain transitions (i.e, replace them by self-loops) without having to care about the probability with which these transitions occur. 2.2 State space definition As the purpose of this work is to draw paths, the state space of the MH algorithm should comprise the set of all feasible paths in the considered network. We assume this network to be directed, and we are only interested in cycle-free paths, the finite number of which ensures a finite state space. 1 The approach is straightforward to generalize for a state space of paths with a finite number of cycles. For this, one duplicates the network one or more times. For clarification, consider the case of one duplication, resulting in two identical networks #1 and #2. One connects the upstream node of each link in network #1 to the downstream node of the same link in network #2 with an identical copy of that link. One then samples an arbitrary cycle-free path from the origin in network #1 to the destination in network #2. This path may visit some nodes both in network #1 and in network #2, leading to a finite number of cycles in terms of the original network. 1 A path is defined as a sequence of nodes. The following notation is used: N node set \u0393 a (cycle-free) path \u2223\u0393\u2223 number of nodes in path \u0393 \u0393(a) the ath node of path \u0393 \u0393 \u22121(v) the position of node v \u2208 \u0393 in \u0393, between 1 and \u2223\u0393\u2223 \u0393(a, b) sub-path of \u0393 between node positions 1\u2a7d a \u2a7d b \u2a7d\u2223\u0393\u2223 \u0393 1 + \u0393 2 concatenation of paths \u0393 1 and \u0393 2 (eliminates node duplications) \u03b4(\u0393) the length (cost) of path \u0393 SP(v, w) shortest path from node v to node w SP M ( v , w ) shortest path from node v to node w, allowing only for nodes in M \u2286 N to be traversed \u03b4 SP(v,w) shortest path cost from node v to w \u03b4 SP, M ( v , w ) shortest path cost from node v to w, allowing only for nodes in M \u2286 N to be traversed The definition of the length (cost) \u03b4(\u0393) of path \u0393 is completely in the hands of the analyst; typical specifications are the number of nodes in the path or the sum of link costs, such as lengths or travel times, along the path. The notion of a shortest path is hence to be understood consistently with the analyst\u2019s specification of \u03b4(\u0393). It needs to be stressed that shortest paths are only used to define an efficiently computable proposal distribution; the target distribution does not need to be defined in terms of shortest paths and may include any nonlinear function of the path\u2019s layout, such as a measure of its circuitousness. The representation of a path as a sequence of nodes renders the following requirement necessary. Requirement 1 The shortest path (SP) between the upstream node and the downstream node of every link runs across that link. This ensures that (i) every link can be covered by an SP and (ii) every pair of nodes is connected by at most one link. The purpose of this requirement is to ensure that every possible path can be constructed by a concatenation of SPs. A link that violates this requirement is never contained in an SP, and hence all paths that contain this link cannot be assembled from SP segments. If a given network violates this requirement, it can be enforced by adding a dummy node in the center of every problematic link. The special case of two or more SPs of equal cost connecting two nodes is treated further below. The state space is now defined as follows. Definition 1 The state space S of the MH algorithm consists of tuples (\u0393, a, b, c) where \u0393 is a cycle-free path connecting origin and destination and a, b, c are integer numbers with 1\u2a7d a < b < c \u2a7d\u2223\u0393\u2223. There are | \u0393 | 3 = | \u0393 | ( | \u0393 | - 1 ) ( | \u0393 | - 2 ) / 6 configurations of a, b, c for a given path \u0393. This means that the ratio of the state space size to the number of paths is in the order of the average path length to the third power. The supplementary integer numbers are not strictly necessary but will turn out helpful to evaluate the proposal distribution Q. Definition 1 excludes paths of less than three nodes from the state space, which, however, would only affect a single-link connection of origin and destination. Adding one dummy node in the center of that link would move it into the state space as well. 2.3 Target weights Assume that the target weight for path \u0393 is d(\u0393). Due to the supplementary index variables a, b, c, there are \u2223\u0393\u2223(\u2223\u0393\u2223\u22121)(\u2223\u0393\u2223\u22122)/6 states that correspond to the same path \u0393. All of these states have the same weight d(\u0393), and hence they have the same stationary sampling probability. The stationary probability of sampling path \u0393 hence becomes \u2223\u0393\u2223(\u2223\u0393\u2223\u22121)(\u2223\u0393\u2223\u22122)/6 times the stationary sampling probability of any state comprising this path. This is undesirable because it implies that defining a path weight d(\u0393) that is independent of the number of nodes in the path leads to a stationary sampling probability that depends on the number of nodes in the path. To give an example, consider two paths \u0393 1 and \u0393 2 with identical weights d ( \u0393 1 ) = d ( \u0393 2 ) = d \u00af , and assume that these weights were assigned with the intention to realize uniform stationary path sampling probabilities. Let \u0393 1 consists of three nodes and \u0393 2 consists of four nodes. For \u0393 1, this results in 3\u00b72\u00b71/6=one possible index configuration, and for \u0393 2, this results in 4\u00b73\u00b72/6=four possible index configurations. This means that there is one state comprising path \u0393 1 and there are four states comprising path \u0393 2. The weight definition d ( \u0393 1 ) = d ( \u0393 2 ) = d \u00af only looks at the path contained in a state, and hence it implies that each of these five states receives a stationary sampling probability of 1/5. However, there is only one state comprising \u0393 1, and hence the stationary probability of sampling path \u0393 1 is 1/5 instead of the originally intended 1/2. In order to eliminate the effect of the index variables (which are nothing but part of the algorithm\u2019s internal bookkeeping), the weight associated with state i containing path \u0393 is defined as (1) b ( i ) = d ( \u0393 ) | \u0393 | ( | \u0393 | - 1 ) ( | \u0393 | - 2 ) / 6 . The numerator represents the desired weighting, while the denominator eliminates the effect of the index parameters. The definition of the target weights is application-dependent. In many circumstances, including the route choice context, a natural choice of the weights is some exponentially decreasing function exp[\u2212\u03bc\u03b4(\u0393)] of the path cost \u03b4(\u0393) where \u03bc is a non negative scale parameter: \u03bc =0 results in uniform weights that do not distinguish between paths of different cost, whereas \u03bc \u2192\u221e enforces that only the SP is considered. In this case, one obtains (2) b ( i ) = exp [ - \u03bc \u03b4 ( \u0393 ) ] | \u0393 | ( | \u0393 | - 1 ) ( | \u0393 | - 2 ) / 6 . The weight specification (2) is used in all experiments of this article. Note that the cost based on which the target weights are defined may be different from the cost that is used further below to specify computationally efficient proposal distributions that rely heavily on SPs. The target weights may be arbitrary, also nonlinear, functions of the path\u2019s layout, whereas efficient SPs are dependent on link-additive costs. The random walk distribution of Frejinger et al. (2009) can be realized within this framework by (i) defining turning probabilities as in Frejinger et al. (2009) and (ii) defining paths weights by multiplying the corresponding turning probabilities within the path. 2.4 Generic definition of proposal distribution For reasons of computational efficiency, the proposal distribution relies heavily on SP computations. This calls for a second requirement. Requirement 2 For every node pair (v, w) that is connected by multiple SPs, the function SP (v, w) reproducibly returns one particular element out of this set. (The analogous statement holds for SPs on reduced node sets.) This calls for a unique ordering of paths: If there are multiple paths connecting v and w at the same minimum cost, exactly one of these paths is chosen according to this ordering. The underlying criterion may be arbitrary (e.g., lexicographic) but must yield reproducible results. Without this requirement, it would be necessary to identify all SPs between a node pair in order to define the proposal distribution (e.g., uniformly across all SPs). The limitation to a single, selected SP hence reduces the complexity of the algorithm, and it will turn out in Section 2.6.2 to be easily implemented. Also, this requirement does not limit the set of paths that can be reached by the algorithm because the irreducibility of the resulting proposal distribution is guaranteed in Section 2.4.4. In the following, the proposal distribution Q is procedurally defined in terms of two operations, labeled SPLICE and SHUFFLE. These operations are first introduced independently; their combination into a joint proposal distribution is given afterward. 2.4.1 SPLICE operation Given a current state i =(\u0393, a, b, c), a proposal state i\u2032=(\u0393\u2032, a\u2032, b\u2032, c\u2032) is generated by the following operations: 1. Draw an \u201cinsertion node\u201d v according to some pre-specified proposal distribution P insert(v), which is strictly positive for all v \u2208 N . A concrete instance of P insert(v) is discussed in Section 2.5. 2. Let \u0393 1 = SP N 1 ( i ) ( \u0393 ( a ) , v ) where N 1 ( i ) = N \u29f9 \u0393 ( 1 , a - 1 ) \u29f9 \u0393 ( c , | \u0393 | ) . This is an SP from \u0393(a) to v excluding all nodes in \u0393 up to position a (exclusive) and as from position c (inclusive). If no such path exists, let i\u2032= i, i.e., maintain the original state, and terminate the SPLICE operation. 3. Let \u0393 2 = SP N 2 ( i ) ( v , \u0393 ( c ) ) where N 2 ( i ) = N \u29f9 \u0393 ( 1 , a ) \u29f9 \u0393 ( c + 1 , | \u0393 | ) . This is an SP from v to \u0393(c) excluding all nodes in \u0393 up to position a (inclusive) and as from position c (exclusive). If no such path exists, let i\u2032= i, i.e., maintain the original state, and terminate the SPLICE operation. 4. Let \u0393 \u223c = \u0393 ( 1 , a ) + \u0393 1 + \u0393 2 + \u0393 ( c , | \u0393 | ) . This is the original path with a detour from \u0393(a) to \u0393(c) that goes through v. If \u0393 \u02dc has a cycle, let i\u2032= i, i.e., maintain the original state, and terminate the SPLICE operation. 5. Let \u0393 \u2032 = \u0393 \u223c , a \u2032 = a , b \u2032 = \u0393 \u223c - 1 ( v ) , c \u2032 = b \u2032 + | \u0393 2 | - 1 . That is, take over the new path and adjust the indices such that a\u2032 and c\u2032 point at the same nodes as before and let b\u2032 point at the insertion node v. Depending on i, this operation introduces either a detour or a shortcut into \u0393, anchored at positions a and c. If neither is feasible, the original state is maintained. Fig. 2 provides an example. Assume that the original state i consists of the path \u0393 ={A, B, C, D, E} (solid arrows) and the location indices (a, b, c)=(2,3,4). The newly drawn insertion node is G. It is connected to node \u0393(a)= B through {B, F, G} and to node \u0393(c)= D through {G, D}. Replacing the segment {B, C, D} in \u0393 by the resulting detour (dashed arrows) yields the new path \u0393\u2032={A, B, F, G, D, E}. The new location indices are computed such that (i) the new indices a\u2032=2 and c\u2032=5 still identify the original \u201cboundary\u201d nodes B = \u0393\u2032(a\u2032) and D = \u0393\u2032(c\u2032) and (ii) b\u2032=4 points at the insertion node \u0393\u2032(b\u2032)= G. This definition of the SPLICE operation forbids cycles in two different ways. The insertion node is linked to the original path via SPs on reduced node sets N 1 ( i ) and N 2 ( i ) in steps 2 and 3. This renders the computation of splice segments \u0393 1 and \u0393 2 that intersect the original path either upstream of a or downstream of c impossible. The suchlike forbidden \u201couter cycles\u201d are shown in Fig. 3 . The solid lines are links of substantial, say unit, cost, and the dashed lines are of very small, say almost zero, cost. If the node sets N \u29f9 N 1 and N \u29f9 N 2 were not excluded from the SP calculations connecting a to b and b to c, cycles along the dashed lines could occur. However, it still is possible that \u0393 1 and \u0393 2 intersect directly, leading to the \u201cinner cycles\u201d shown in Fig. 4 . Again, the solid lines are links of substantial, say unit, cost, and the dashed lines are of very small, say almost zero, cost. The exclusion of the node sets N \u29f9 N 1 and N \u29f9 N 2 from the SP calculations does not exclude cycles that result from a crossing of the inner path segments a to b and b to c along the dashed lines. If an inner cycle is constructed in step 4, the original path is maintained, such that \u0393\u2032 is guaranteed to be cycle-free. The rational for these two different treatments of cycles is to ensure irreducibility of the complete proposal distribution, as discussed in Section 2.4.4. 2.4.2 SHUFFLE operation Given a current state i =(\u0393, a, b, c), a proposal state i\u2032=(\u0393\u2032, a\u2032, b\u2032, c\u2032) is generated by the following operations: 1. Draw a triplet (a\u2032, b\u2032, c\u2032) with 1\u2a7d a\u2032< b\u2032< c\u2032\u2a7d\u2223\u0393\u2223 from some distribution P shuffle(a\u2032, b\u2032, c\u2032\u2223i). This distribution must be such that any index configuration 1\u2a7d a\u2033< b\u2033< c\u2033\u2a7d\u2223\u0393\u2223 can be reached in a finite number of SHUFFLE operations. 2. Let \u0393\u2032= \u0393. A concrete instance of P shuffle(a\u2032, b\u2032, c\u2032\u2223i) is discussed in Section 2.5. This operation merely shuffles the three integer state components but leaves the path unaffected. Its purpose is to randomly change the anchor points for the SP computations of the SPLICE operation. 2.4.3 Combined proposal It remains to combine the SPLICE and SHUFFLE operations into one proposal. Since the simulation of any proposal transition i \u2192 j with q(i, j)>0 also requires to compute the inverse transition probability q(j, i) and since the i \u2192 j transition is invariably rejected if q(j, i)=0 (cf. Algorithm 1), it is desirable to ensure that q(i, j)>0\u21d4 q(j, i)>0 holds, i.e., that a transition is invertible. Definition 2 A state i =(\u0393, a, b, c) is called \u201cspliceable\u201d if the path segments from \u0393(a) to \u0393(b) and from \u0393(b) to \u0393(c) are SPs, i.e, if \u0393(a, b)=SP (\u0393(a), \u0393(b)) and \u0393(b, c)=SP(\u0393(b), \u0393(c)). (The analogous definition holds for SPs on reduced node sets.) This implies that every state resulting from a SPLICE operation is itself spliceable. The SPLICE operation is only allowed if the chain is in a spliceable state (which is guaranteed to happen occasionally, as discussed in Section 2.4.4). If it is allowed, the SPLICE operation is conducted with probability P splice \u2208(0,1). In every other case, a SHUFFLE is conducted. The motivation for this requirement is as follows. If a SPLICE operation is conducted in a non-spliceable state, then this operation will most likely change the nodes in the path. The original path could then only be recovered through another SPLICE operation. This, however, is not possible because the original state was not spliceable, cf. Definition 2. The MH algorithm will hence reject this proposal. It therefore is of computational advantage to not attempt such transitions at all. Further, the notion of \u201cspliceability\u201d helps to structure the computation scheme for the proposal probabilities presented in Section 2.5. In summary, the combined proposal of going from a feasible state i to a feasible state i\u2032 is as follows: 1. If \u0393 is spliceable, do with probability P splice: (a) i\u2032=SPLICE (i). Otherwise (\u0393 is not spliceable or event with probability P splice did not occur): (a) i\u2032=SHUFFLE (i). The sensitivity analysis of Section 3.2 indicates that P splice values between 0.5 and 0.75 yield a good and robust computational performance for the concrete SPLICE and SHUFFLE operations defined in Section 2.5. 2.4.4 Irreducibility This section demonstrates that any proposal distribution Q that complies with the previously defined framework is irreducible. For this, we first consider the following transition sequence from an SP to an arbitrary cycle-free target path \u0393 \u2217: 1. Let \u0393 =SP(\u0393 \u2217(1), \u0393 \u2217(\u2223\u0393 \u2217\u2223)). 2. For \u03b2 =2\u2026\u2223\u0393 \u2217\u2223\u22121: (a) SHUFFLE a finite number of times such that a = \u03b2 \u22121 and c =\u2223\u0393\u2223. (b) SPLICE with insertion node v = \u0393 \u2217(\u03b2). This process builds the target path \u0393 \u2217 starting from an SP forwards through the iterations. As from step 1, \u0393(1)= \u0393 \u2217(1) and \u0393(\u2223\u0393\u2223)= \u0393 \u2217(\u2223\u0393 \u2217\u2223). In every iteration, the SHUFFLE leads to a configuration where a is at the downstream end of that part of \u0393 that already overlaps with \u0393 \u2217: \u0393(1, a)= \u0393 \u2217(1, a). The SPLICE operation then adds the immediate next target node \u0393 \u2217(\u03b2) with \u03b2 = a +1. The SPLICE is always feasible for the following reasons: (i) The current path is spliceable (cf. Definition 2) because the last SHUFFLE placed b on the SP between a and c (that path segment was computed as an SP in the previous SPLICE operation); (ii) no inner cycle is possible because a and \u03b2 are adjacent; (iii) at least the target path constitutes one feasible connection from \u0393 \u2217(\u03b2) to \u0393(c). After \u2223\u0393 \u2217\u2223\u22122 SPLICE operations, the target path is constructed with positive probability. Now the two different treatments of cycles in the SPLICE operation of Section 2.4.1 can be justified: The explicit exclusion of outer cycles ensures that every step of the incremental target path building is possible (never runs into an outer cycle). This safeguard is not necessary when dealing with inner cycles because these cannot occur in the incremental building anyway, cf. item (ii) in the previous paragraph. The transition from an arbitrary path \u0393 1 to another arbitrary path \u0393 2 follows from the following observations: (i) The transition \u0393 1 \u2192 \u0393 2 can always be decomposed into \u0393 1 \u2192SP\u2192 \u0393 2, (ii) the transition SP\u2192 \u0393 2 has just been demonstrated; (iii) the transition \u0393 1 \u2192SP is just as feasible as the transition SP\u2192 \u0393 1 because of the invertibility of the proposal distribution. Hence, Q is irreducible. 2.5 Concrete instance of proposal distribution This section specifies a concrete instance of the previously defined framework. It needs to be stressed that the methodology is not limited to the distributional assumptions made here but can accommodate a wealth of alternative specifications. A concrete instance of the selection probability P insert(v) for an insertion node v \u2208 N in the SPLICE operation is (3) P insert ( v ) = exp [ - \u03bc \u02dc ( \u03b4 SP ( origin, v ) + \u03b4 SP ( v ,destination ) ) ] \u2211 w \u2208 N exp [ - \u03bc \u02dc ( \u03b4 SP ( origin, w ) + \u03b4 SP ( w ,destination ) ) ] where \u03bc \u02dc is a finite, non-negative scale parameter that controls how distant from the SP between origin and destination the insertion node is drawn. As required in Section 2.4.1, every node can be selected with positive probability. This distribution is used in all experiments of this article. The sensitivity analysis of Section 3.2 indicates that letting \u03bc \u02dc = \u03bc yields a good and robust computational performance. A single evaluation of (3) is computationally costly due to the sum over all nodes in the denominator, and many such evaluations are needed in the MH algorithm. However, this distribution is state-independent, and hence it can be pre-computed and cached once before the MH algorithm is executed. That is, each node is assigned an insertion probability prior to the path sampling, and this probability is kept fixed throughout the sampling process. In consequence, the denominator in (3) does not affect the method\u2019s computational performance. A concrete instance of the SHUFFLE distribution P shuffle(a\u2032, b\u2032, c\u2032\u2223i) is (4) P shuffle ( a \u2032 , b \u2032 , c \u2032 | i ) = | \u0393 | ( | \u0393 | - 1 ) ( | \u0393 | - 2 ) 6 - 1 if 1 \u2a7d a \u2032 < b \u2032 < c \u2032 \u2a7d | \u0393 | 0 otherwise. This distribution is uniform over all ascending index sequences within the given path. As required in Section 2.4.2, every index configuration can be reached in a finite (here: one) number of transitions. This distribution is used in all experiments of this article. The transition probabilities q(i, i\u2032) that result from these specifications are defined in the flowchart of Fig. 5 . The computation of these transition probabilities is a key ingredient of the MH algorithm. They are not trivial to compute because even if one knowns through what operation a particular transition i \u2192 i\u2032 has been realized, one still has to account for all other operations that could also have led to this transition. The relative tractability of the presented computations is owed to several facts: \u2022 If the index variables were not included in the state space but were generated on the fly, then there could be multiple SPLICE operations leading to the same path, and the probabilities of all corresponding transitions would have to be summed up. \u2022 If requirement 2 did not call for unique SP operations, then one out of possibly many SPs would have to be drawn from a well-defined distribution across all SPs, requiring their enumeration. \u2022 In the case of a self-loop, with i = i\u2032, the acceptance probability (cf. step 3b in Algorithm 1) simplifies into (5) \u03b1 ( i , i \u2032 ) = min b ( i \u2032 ) q ( i \u2032 , i ) b ( i ) q ( i , i \u2032 ) , 1 = min b ( i ) q ( i , i ) b ( i ) q ( i , i ) , 1 = 1 , such that a computation of q(i, i) is never required. This completes the presentation of the new method. Algorithm 2 summarizes the approach and points to the decisive equations. Algorithm 2 MH algorithm for path sampling. 1. Set iteration counter k =0. 2. Select arbitrary initial state i k =(\u0393, a, b, c) k . For instance, (a) let \u0393 k be the shortest path; (b) draw (a, b, c) k uniformly with 1\u2a7d a k < b k < c k \u2a7d\u2223\u0393 k \u2223. 3. Repeat beyond stationarity: (a) If \u0393 k is spliceable, do with probability P splice: (i) Draw candidate state j with a SPLICE operation as described in Section 2.4.1, using the concrete insertion node distribution (3). Otherwise (\u0393 k is not spliceable or event with probability P splice did not occur), (i) draw candidate state j with a SHUFFLE operation as described in Section 2.4.2, using the concrete index selection distribution (4). (b) Compute transition probabilities q(i k , j) and q(j, i k ) according to Fig. 5. (c) Compute acceptance probability \u03b1 ( i k , j ) = min b ( j ) q ( j , i k ) b ( i k ) q ( i k , j ) , 1 . (d) With probability \u03b1(i k , j), let i k+1 = j; else, let i k+1 = i k . (e) Increase k by one. 2.6 Implementation notes The proposed method is implemented in the Java programming language 2 http://www.java.sun.com 2 and is freely available on the Internet 3 http://transp-or.epfl.ch/bioroute/. 3 . This section elaborates on some aspects of its implementation. 2.6.1 Logarithmic probabilities Given the size of its state space, the MH algorithm deals with extremely small numbers when computing acceptance probabilities from weights and proposal probabilities. These numbers are therefore stored and processed in logarithmic form whenever possible. In consequence, the acceptance probability \u03b1(i, j) in Algorithms 1 and 2 is computed from (6) ln \u03b1 ( i , j ) = ( ln b ( j ) - ln b ( i ) ) + ( ln q ( j , i ) - ln q ( i , j ) ) and then compared to the logarithm of a uniform random number. The brackets on the right-hand side collect quantities of similar order of magnitude (weights and proposal probabilities). 2.6.2 Unique SP ordering Requirement 2 calls for a unique ordering of paths, such that situations can be uniquely resolved where multiple SPs between an origin and a destination node exist. For this, one first computes for each node in the network its minimum distance from the origin, using, e.g., Dijkstra\u2019s algorithm (Dijkstra, 1959). Then one builds a unique SP as follows: 1. Start with an SP under construction consisting only of the destination node. 2. Label the destination node as the current node. 3. While the current node is not the origin node: (a) Select that upstream node of the current node that has the smallest distance from the origin. If multiple such nodes exist, select the first of these nodes based on a lexicographical rule. Label this node as the new current node. (b) Attach the current node to the beginning of the SP under construction. The uniqueness of the resulting SP is due to step 3a, which defines a unique traversal order in the distance-labeled network, even if there are multiple alternative paths of identical cost. 2.6.3 Scale-invariance When sampling paths from a logit distribution, the scale parameter should be chosen consistently with the level of path cost, which differs among OD pairs. A manual adjustment of the scale parameter per OD pair can be avoided by defining a single parameter \u03b6 \u2a7e1 that is chosen such that a path of cost \u03b6\u03b4 SP is sampled with half the probability of the shortest path (of cost \u03b4 SP): exp (\u2212\u03bc\u03b6\u03b4 SP)/exp (\u2212\u03bc\u03b4 SP)=0.5. This yields the following scale parameter: (7) \u03bc = ln 2 ( \u03b6 - 1 ) \u03b4 SP A \u03b6 of one yields an infinite \u03bc and only samples the shortest path, whereas an infinite \u03b6 yields a zero \u03bc and samples paths independently of their cost. The scale parameters used in the experiments of Section 3.2 correspond to \u03b6 values between 1.0032 and 1.0129. 3 Experiments Two experiments are presented. The simple example of Section 3.1 allows for a path enumeration such that the precision of the proposed algorithm can be analyzed. The Tel-Aviv example of Section 3.2 then demonstrates the algorithm\u2019s feasibility for large real-world networks. 3.1 Simple example The first series of experiments is based on the synthetic network of Frejinger et al. (2009). This is a cycle-free network with 64 links, 38 nodes, and 170 paths connecting the origin (node number 1) to the destination (node number 38). It is shown in Fig. 6 . The loop-free network layout ensures that a random walk reaches the destination in at most 12 steps. Three experiments are conducted, with P splice =0.5 and \u03bc = \u03bc \u02dc taking values of zero, two, and four. Each experiment runs the MH algorithm for 108 iterations. The link cost based on which the weights and the SPs are computed is defined as the geometrical link length.The weights are computed according to (2), which is an exponentially decreasing function of the geometrical path length \u03b4(\u0393). Also, (2) corrects for the number of nodes in a path, which hence does not affect the stationary path sampling distribution. Due to the locality of its transition distribution, the MH algorithm typically generates similar states in subsequent iterations, with this similarity ceasing as the iteration distance between two states increases. This effect is quantified through the similarity measure (8) \u03d5 ( d ) = 1 K \u2211 k = 1 K | \u0393 k \u2229 \u0393 k + d | 1 2 ( | \u0393 k | + | \u0393 k + d | ) where \u2223\u0393 k \u2229 \u0393 k+d \u2223 is the number of identical nodes in the paths generated in iterations k and k + d. The results are shown in Fig. 7 . \u03d5(d) decreases monotonically with d, which means that the average similarity of paths decreases with their distance in the chain. In all three subfigures, the similarity stabilizes around 0.5. This is so because the network is quite constrained, and even completely random paths are still likely to overlap. For each distance value d, a linear regression model is fitted to the 10 data points (\u03d5(d), d),\u2026,(\u03d5(d +9), d +9). The smallest d value at which the absolute slope of this linear model is below 10\u22123 constitutes the within-chain distance at which sample independence is postulated:2900 for \u03bc =0, 2400 for \u03bc =2, and 2100 for \u03bc =4, as indicated by the dotted vertical line in each plot of Fig. 7. Since each chain is initialized with an SP, which is already well centered in the target distribution, the first 2900 (resp. 2400 and 2100) samples are discarded, and then every 2900th (resp. 2400th and 2100th) path is extract as an independent sample. The ability of the MC to create the desired target distribution is demonstrated in Fig. 8 . Each subfigure contains 170 points, one per path, where the x-coordinate represents the target probability of the respective path and the y-coordinate represents the frequency of this path in the sample. The points are symmetrically distributed around the main diagonal, which indicates an unbiased reproduction of the target distribution. The small remaining scatter is due to the fact that the empirical frequencies are obtained from a finite sample. For \u03bc =0, all paths have the same target probability, whereas for \u03bc =4, clear differences are made between paths of different length. The consistency of the samples with the target distribution is quantified through the X 2 statistic (9) X 2 = \u2211 c = 1 C ( E c - O c ) 2 E c where c indexes the C discrete outcomes (C =170 in the present case), E c is the expected number of realizations of category c, and O c is the respective observed number. For independent draws, the X 2 statistic is asymptotically \u03c7 2 distributed with C \u22121 degrees of freedom. The asymptotic approximation is valid if the expected frequency of not too many categories falls below five. In the present experiments, the smallest expected frequency is 24.98, such that the \u03c7 2 distribution is fully justified. The 90% and 95% quantiles of a \u03c7 2 distribution with 169 degrees of freedom are 192.95 and 200.33.The experimentally obtained X 2 statistics are 182.54, 165.11, and 189.07 for \u03bc values of zero, two, and four. Given that all statistics are below the 90 % percentile of the \u03c7 2 distribution, the hypothesis of consistency between desired and realized distribution can safely be accepted. 3.2 Complex example These experiments are based on the road network of Tel-Aviv, Israel, which is shown in Fig. 9 . It consists of 17 118 links and 7 879 nodes. The considered origin/destination (OD) relation is located in the densely meshed network of the city center, which allows for a huge number of possible paths and opportunities for loops. It can be identified in Fig. 10 . Overall 27 experiments of 107 iterations each are conducted, for all combinations of the parameter values \u03bc =0.01/0.02/0.04, \u03bc \u02dc = 0.5 \u03bc / 1.0 \u03bc / 2.0 \u03bc , and P splice =0.25/0.5/0.75. The purpose of these experiments is to identify the effect of the parameters \u03bc \u02dc and P splice on the computational performance of the algorithm, given different target distributions defined by \u03bc. (Recall that \u03bc \u02dc and P splice only have an effect on the proposal distribution but do not change the target distribution.) To give a first visual impression of the problem configuration, Fig. 10 shows, for each value of \u03bc, the set of all links that are contained in at least one independently sampled path in black color. As \u03bc gets smaller, the covered region of the network gets larger. All experiments were conducted on an IBM BladeCenter HS22 with 10 blades each containing 16 CPU cores running at 2.5GHz. Although the implementation of the algorithm is single-threaded, CPU loads of up to 150 % were observed, indicating that the Java code spread out across multiple cores. For the sake of comparability, each experiment was therefore bound to a single core (using the taskset command of the Linux operating system). The reported run-times therefore constitute upper bounds. In particular, it should be noted that the algorithm can be trivially parallelized by running multiple independent program instances and merging the resulting samples. Table 1 summarizes the computational results. The first three columns of this table indicate the different parameter configurations. Each of the following columns contains three performance measures from three independent experiments. The fourth column shows the total runtime of an experiment with 107 iterations. The fifth column indicates how many iterations of the MH algorithm need to be skipped between two extracted path samples in order to ensure independence, following the same criterion as used in Section 3.1. Finally, the last column reports how long it takes to extract a single independent sample. The total runtimes are fairly stable across different target distributions, i.e., across different \u03bc values. They are also very stable across replications. The number of iterations per independent sample, on the other hand, increases substantially as the covered state space gets larger, i.e., for smaller \u03bc. In addition, this number is quite variable. The number of iterations per independent sample is hence decisive for the algorithm\u2019s computational performance. A \u03bc \u02dc / \u03bc ratio of 2.0 is clearly inferior to ratios of 0.5 and 1.0. This can be explained by the very high within-chain correlation that results from a too narrow proposal distribution (3). A P splice value of 0.25 is inferior to values of 0.5 and 0.75. It leads to the frequent occurrence of successive SHUFFLE operations, which do not add to the path variability and hence result in a high within-chain correlation. The remaining configurations with P splice \u2208{0.5,0.75} and \u03bc \u02dc / \u03bc \u2208 { 0.5 , 1.0 } are quite similar in their performance, across all \u03bc values. Selecting a P splice value of 0.75 slightly outperforms a value of 0.5, whereas the difference between \u03bc \u02dc / \u03bc values of 0.5 and 1.0 is neglegible. These configurations are hence recommended as starting values in new applications of the method. 4 Conclusion We have presented an efficient Metropolis\u2013Hastings algorithm to sample paths according to an arbitrary distribution. The key methodological contribution is the definition of the state space and the proposal distribution that match the requirements of the MH framework. The method is validated on a small network, where it is shown that the frequency of the generated paths corresponds to the target distribution. Its applicability on a real network is demonstrated, using a prototype implementation. Given the good computational speed of this prototype, the method is definitely adequate for real applications. The method is clearly well suited for the generation of choice sets for route choice models. However, its specification is independent of this application, making it appropriate for any context where sampling of paths is necessary, including sampling of alternatives for models of activity sequence choice, probabilistic map matching, dynamic traffic assignment, and route guidance. In addition to these applications, future research will involve adapting the method to multi-modal networks, where the underlying structure may be exploited in the definition of the SPLICE operation. Acknowledgment We would like to thank Shlomo Bekhor to give us access to the Tel-Aviv network data. References Bekhor et al., 2006 S. Bekhor M. Ben-Akiva M. Ramming Evaluation of route choice set generation algorithms for route choice models Annals of Operations Research 144 1 2006 235 247 Bierlaire et al., 2013 M. Bierlaire J. Chen J. Newman A probabilistic map matching method for smartphone GPS data Transportation Research Part C 26 2013 78 98 Bottom, 2000 Bottom, J., 2000. Consistent Anticipatory Route Guidance, PhD thesis. Massachusetts Institute of Technology. Bottom et al., 1999 J. Bottom M. Ben-Akiva M. Bierlaire I. Chabini H. Koutsopoulos Q. Yang Investigation of route guidance generation issues by simulation with DynaMIT A. Ceder Proceedings of the 14th International Symposium on Transportation and Traffic Theory 1999 Pergamon Jerusalem, Israel 577 600 Bowman and Ben-Akiva, 1998 J. Bowman M. Ben-Akiva . Activity based travel demand model systems P. Marcotte S. Nguyen Equilibrium and Advanced Transportation Modelling 1998 Kluwer 27 46 Dijkstra, 1959 E.W. Dijkstra A note on two problems in connexion with graphs Numerische Mathematik 1 1959 269 271 Fl\u00f6tter\u00f6d et al., 2011 G. Fl\u00f6tter\u00f6d M. Bierlaire K. Nagel Bayesian demand calibration for dynamic traffic simulations Transportation Science 45 4 2011 541 561 Frejinger and Bierlaire, 2010 E. Frejinger M. Bierlaire On path generation algorithms for route choice models S. Hess A. Daly Choice Modelling: The State-of-the-Art and the State-of-Practice 2010 Emerald Group Publishing Limited 307 315 ISBN: 978-1-84950-772-1 Frejinger et al., 2009 E. Frejinger M. Bierlaire M. Ben-Akiva Sampling of alternatives for route choice modeling Transportation Research Part B 43 10 2009 984 994 Hastings, 1970 W. Hastings Monte Carlo sampling methods using Markov chains and their applications Biometrika 57 1 1970 97"